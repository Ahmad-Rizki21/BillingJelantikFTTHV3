import{d as ce,r as c,c as ve,o as me,a as h,p as pe,b as fe,w as l,e as i,f as n,g as t,h as o,t as u,l as _e,_ as ge}from"./index-DDZ3D2Zd.js";import{d as ke}from"./debounce-BMmXVQ06.js";const be={class:"d-flex align-center mb-6"},xe={class:"d-flex align-center"},we={class:"d-flex flex-wrap align-center gap-4 pa-4"},ye={class:"font-weight-bold"},Ve={class:"text-caption text-medium-emphasis"},Se={class:"d-flex justify-center ga-2"},he={class:"dialog-header pa-6"},Ce={class:"d-flex align-center"},ze={class:"text-h5 text-white font-weight-bold mb-1"},Ue={class:"text-subtitle-2 text-blue-lighten-4 mb-0"},Ie={class:"form-section mb-6"},De={class:"section-header mb-4"},Ae={class:"form-section mb-6"},Me={class:"section-header mb-4"},Te={class:"form-section"},$e={class:"section-header mb-4"},Fe={class:"d-flex align-center justify-space-between"},Pe={class:"text-body-2 text-medium-emphasis mb-0"},Be={class:"text-body-1 text-medium-emphasis mb-4"},Ne={class:"text-error"},Ke=ce({__name:"MikrotikView",setup(je){const C=c([]),D=c(!0),A=c(!1),M=c(!1),z=c(!1),U=c(!1),v=c(-1),T=c(null),p=c(!1),$=c(!1),f=c(""),_=c(null),g=c(null),F={id:null,name:"",host_ip:"",port:8728,username:"",password:"",is_active:!0},d=c({...F}),V=c(null),k=c({show:!1,text:"",color:"success",icon:"mdi-check-circle"}),P={required:s=>!!s||"Field ini wajib diisi"},Y=[{title:"Server Info",key:"name",sortable:!0},{title:"ROS Version",key:"ros_version",sortable:!1,align:"center"},{title:"Status",key:"is_active",align:"center"},{title:"Koneksi Terakhir",key:"last_connection_status",align:"center"},{title:"Actions",key:"actions",sortable:!1,align:"center",width:"320px"}],J=ve(()=>v.value===-1?"Tambah Server Baru":"Edit Server");me(()=>{b()});async function b(){D.value=!0;try{const s=new URLSearchParams;f.value&&s.append("search",f.value),_.value!==null&&s.append("is_active",String(_.value)),g.value&&s.append("last_connection_status",g.value);const e=await h.get(`/mikrotik_servers/?${s.toString()}`);C.value=e.data}catch(s){console.error(s)}finally{D.value=!1}}const W=ke(()=>{b()},500);pe([f,_,g],()=>{W()});function X(){f.value="",_.value=null,g.value=null}function K(s){v.value=s?C.value.indexOf(s):-1,d.value=s?{...s,password:""}:{...F},p.value=!1,z.value=!0}function j(){z.value=!1,d.value={...F},v.value=-1,p.value=!1}async function Z(){A.value=!0;const s={...d.value};v.value>-1&&!s.password&&delete s.password;try{v.value>-1?await h.patch(`/mikrotik_servers/${s.id}`,s):await h.post("/mikrotik_servers/",s),b(),j(),x(v.value>-1?"Server berhasil diperbarui!":"Server baru berhasil ditambahkan!","success")}catch(e){console.error(e),x("Gagal menyimpan server. Silakan coba lagi.","error")}finally{A.value=!1}}async function ee(s){T.value=s.id;try{const e=await h.post(`/mikrotik_servers/${s.id}/test_connection`);x(`Berhasil terhubung! ROS: ${e.data.ros_version||e.data.router_os_version}`,"success"),b()}catch(e){const r=e.response?.data?.detail||"Gagal terhubung ke server.";x(`Error: ${r}`,"error"),b()}finally{T.value=null}}function te(s){V.value=s,U.value=!0}function q(){U.value=!1,V.value=null}async function le(){if(V.value){M.value=!0;try{await h.delete(`/mikrotik_servers/${V.value.id}`),b(),q(),x("Server berhasil dihapus!","success")}catch(s){console.error(s),x("Gagal menghapus server. Silakan coba lagi.","error")}finally{M.value=!1}}}function x(s,e){k.value={show:!0,text:s,color:e,icon:e==="success"?"mdi-check-circle":"mdi-alert-circle"}}function ae(s){return s==="Success"||s==="Connected"?"success":s==="Failed"?"error":"grey"}function se(s){return s==="Success"||s==="Connected"?"mdi-check-circle":s==="Failed"?"mdi-close-circle":"mdi-help-circle"}return(s,e)=>{const r=i("v-icon"),B=i("v-avatar"),I=i("v-spacer"),m=i("v-btn"),w=i("v-text-field"),H=i("v-select"),y=i("v-card"),N=i("v-chip"),R=i("v-card-title"),oe=i("v-data-table"),S=i("v-col"),E=i("v-row"),ne=i("v-switch"),ie=i("v-form"),G=i("v-card-text"),O=i("v-card-actions"),L=i("v-dialog"),re=i("v-alert"),de=i("v-snackbar"),ue=i("v-container");return _e(),fe(ue,{fluid:"",class:"pa-6"},{default:l(()=>[n("div",be,[n("div",xe,[t(B,{class:"me-3",color:"info",size:"40"},{default:l(()=>[t(r,{color:"white"},{default:l(()=>e[15]||(e[15]=[o("mdi-server-network")])),_:1,__:[15]})]),_:1}),e[16]||(e[16]=n("div",null,[n("h1",{class:"text-h4 font-weight-bold text-info"},"Mikrotik Servers"),n("p",{class:"text-subtitle-1 text-medium-emphasis mb-0"},"Kelola koneksi ke server Mikrotik Anda")],-1))]),t(I),t(m,{color:"info",size:"large",elevation:"2",onClick:e[0]||(e[0]=a=>K()),"prepend-icon":"mdi-plus",class:"text-none"},{default:l(()=>e[17]||(e[17]=[o(" Tambah Server ")])),_:1,__:[17]})]),t(y,{class:"filter-card mb-6",elevation:"0"},{default:l(()=>[n("div",we,[t(w,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),label:"Cari Server (Nama atau IP)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable","hide-details":"",class:"flex-grow-1",style:{"min-width":"300px"}},null,8,["modelValue"]),t(H,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),items:[{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Filter Status Server",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",class:"flex-grow-1",style:{"min-width":"200px"}},null,8,["modelValue"]),t(H,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),items:["Success","Failed"],label:"Filter Status Koneksi",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",class:"flex-grow-1",style:{"min-width":"200px"}},null,8,["modelValue"]),t(m,{variant:"text",onClick:X,class:"text-none"},{default:l(()=>e[18]||(e[18]=[o(" Reset Filter ")])),_:1,__:[18]})])]),_:1}),t(y,{elevation:"3",class:"rounded-lg"}),t(y,{elevation:"3",class:"rounded-lg"},{default:l(()=>[t(R,{class:"d-flex align-center pa-6 bg-grey-lighten-5"},{default:l(()=>[t(r,{start:"",icon:"mdi-format-list-bulleted-square",color:"info"}),e[19]||(e[19]=n("span",{class:"text-h6 font-weight-bold"},"Daftar Server",-1)),t(I),t(N,{color:"info",variant:"outlined",size:"small"},{default:l(()=>[o(u(C.value.length)+" servers ",1)]),_:1})]),_:1,__:[19]}),t(oe,{headers:Y,items:C.value,loading:D.value,"item-value":"id",class:"elevation-0","items-per-page":10},{"item.name":l(({item:a})=>[n("div",ye,u(a.name),1),n("div",Ve,u(a.host_ip)+":"+u(a.port),1)]),"item.is_active":l(({item:a})=>[t(N,{color:a.is_active?"success":"grey",size:"small",variant:"tonal"},{default:l(()=>[t(r,{start:"",size:"14"},{default:l(()=>[o(u(a.is_active?"mdi-check-circle":"mdi-close-circle"),1)]),_:2},1024),o(" "+u(a.is_active?"Aktif":"Nonaktif"),1)]),_:2},1032,["color"])]),"item.last_connection_status":l(({item:a})=>[t(N,{color:ae(a.last_connection_status),variant:"tonal",size:"small"},{default:l(()=>[t(r,{start:"",size:"14"},{default:l(()=>[o(u(se(a.last_connection_status)),1)]),_:2},1024),o(" "+u(a.last_connection_status||"Belum diuji"),1)]),_:2},1032,["color"])]),"item.actions":l(({item:a})=>[n("div",Se,[t(m,{size:"small",variant:"tonal",color:"teal",onClick:Q=>ee(a),class:"text-none",loading:T.value===a.id},{default:l(()=>[t(r,{start:"",size:"16"},{default:l(()=>e[20]||(e[20]=[o("mdi-connection")])),_:1,__:[20]}),e[21]||(e[21]=o(" Test "))]),_:2,__:[21]},1032,["onClick","loading"]),t(m,{size:"small",variant:"tonal",color:"primary",onClick:Q=>K(a)},{default:l(()=>[t(r,{start:"",size:"16"},{default:l(()=>e[22]||(e[22]=[o("mdi-pencil")])),_:1,__:[22]}),e[23]||(e[23]=o(" Edit "))]),_:2,__:[23]},1032,["onClick"]),t(m,{size:"small",variant:"tonal",color:"error",onClick:Q=>te(a)},{default:l(()=>[t(r,{start:"",size:"16"},{default:l(()=>e[24]||(e[24]=[o("mdi-delete")])),_:1,__:[24]}),e[25]||(e[25]=o(" Hapus "))]),_:2,__:[25]},1032,["onClick"])])]),_:1},8,["items","loading"])]),_:1}),t(L,{modelValue:z.value,"onUpdate:modelValue":e[12]||(e[12]=a=>z.value=a),"max-width":"700px",persistent:""},{default:l(()=>[t(y,{class:"rounded-xl elevation-8 dialog-card"},{default:l(()=>[t(R,{class:"pa-0"},{default:l(()=>[n("div",he,[n("div",Ce,[t(B,{class:"me-4",color:"white",size:"48"},{default:l(()=>[t(r,{color:"info",size:"28"},{default:l(()=>[o(u(v.value===-1?"mdi-server-plus":"mdi-server-edit"),1)]),_:1})]),_:1}),n("div",null,[n("h2",ze,u(J.value),1),n("p",Ue,u(v.value===-1?"Tambahkan server Mikrotik baru ke sistem":"Perbarui informasi server Mikrotik"),1)])])])]),_:1}),t(G,{class:"pa-8"},{default:l(()=>[t(ie,{ref:"serverForm",modelValue:$.value,"onUpdate:modelValue":e[11]||(e[11]=a=>$.value=a)},{default:l(()=>[n("div",Ie,[n("div",De,[t(r,{class:"me-2",color:"info"},{default:l(()=>e[26]||(e[26]=[o("mdi-information-outline")])),_:1,__:[26]}),e[27]||(e[27]=n("span",{class:"text-h6 font-weight-bold text-info"},"Informasi Server",-1))]),t(E,{class:"ma-0"},{default:l(()=>[t(S,{cols:"12",class:"pb-2"},{default:l(()=>[t(w,{modelValue:d.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value.name=a),label:"Nama Server",variant:"outlined","prepend-inner-icon":"mdi-server",rules:[P.required],color:"info",class:"elegant-input",hint:"Masukkan nama identifikasi untuk server ini"},null,8,["modelValue","rules"])]),_:1}),t(S,{cols:"12",md:"8",class:"pb-2"},{default:l(()=>[t(w,{modelValue:d.value.host_ip,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.host_ip=a),label:"Host / IP Address",variant:"outlined","prepend-inner-icon":"mdi-ip-network",rules:[P.required],color:"info",class:"elegant-input",hint:"IP Address atau hostname server Mikrotik"},null,8,["modelValue","rules"])]),_:1}),t(S,{cols:"12",md:"4",class:"pb-2"},{default:l(()=>[t(w,{modelValue:d.value.port,"onUpdate:modelValue":e[6]||(e[6]=a=>d.value.port=a),modelModifiers:{number:!0},label:"Port API",type:"number",variant:"outlined","prepend-inner-icon":"mdi-ethernet",color:"info",class:"elegant-input",hint:"Default: 8728"},null,8,["modelValue"])]),_:1})]),_:1})]),n("div",Ae,[n("div",Me,[t(r,{class:"me-2",color:"deep-orange"},{default:l(()=>e[28]||(e[28]=[o("mdi-shield-key")])),_:1,__:[28]}),e[29]||(e[29]=n("span",{class:"text-h6 font-weight-bold text-deep-orange"},"Kredensial Login",-1))]),t(E,{class:"ma-0"},{default:l(()=>[t(S,{cols:"12",md:"6",class:"pb-2"},{default:l(()=>[t(w,{modelValue:d.value.username,"onUpdate:modelValue":e[7]||(e[7]=a=>d.value.username=a),label:"Username",variant:"outlined","prepend-inner-icon":"mdi-account",rules:[P.required],color:"deep-orange",class:"elegant-input",autocomplete:"username"},null,8,["modelValue","rules"])]),_:1}),t(S,{cols:"12",md:"6",class:"pb-2"},{default:l(()=>[t(w,{modelValue:d.value.password,"onUpdate:modelValue":e[8]||(e[8]=a=>d.value.password=a),label:"Password",type:p.value?"text":"password",variant:"outlined","prepend-inner-icon":"mdi-lock","append-inner-icon":p.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":e[9]||(e[9]=a=>p.value=!p.value),color:"deep-orange",class:"elegant-input",placeholder:v.value>-1?"Kosongkan jika tidak berubah":"Masukkan password",autocomplete:"current-password"},null,8,["modelValue","type","append-inner-icon","placeholder"])]),_:1})]),_:1})]),n("div",Te,[n("div",$e,[t(r,{class:"me-2",color:"success"},{default:l(()=>e[30]||(e[30]=[o("mdi-toggle-switch")])),_:1,__:[30]}),e[31]||(e[31]=n("span",{class:"text-h6 font-weight-bold text-success"},"Status Server",-1))]),t(y,{variant:"tonal",color:"success",class:"pa-4"},{default:l(()=>[n("div",Fe,[n("div",null,[e[32]||(e[32]=n("h3",{class:"text-subtitle-1 font-weight-bold mb-1"},"Aktivasi Server",-1)),n("p",Pe,u(d.value.is_active?"Server akan aktif dan dapat digunakan":"Server akan dinonaktifkan sementara"),1)]),t(ne,{modelValue:d.value.is_active,"onUpdate:modelValue":e[10]||(e[10]=a=>d.value.is_active=a),color:"success",size:"large",inset:"",label:d.value.is_active?"Aktif":"Nonaktif"},null,8,["modelValue","label"])])]),_:1})])]),_:1},8,["modelValue"])]),_:1}),t(O,{class:"pa-6 pt-0"},{default:l(()=>[t(I),t(m,{variant:"outlined",size:"large",onClick:j,class:"text-none me-3"},{default:l(()=>[t(r,{start:""},{default:l(()=>e[33]||(e[33]=[o("mdi-close")])),_:1,__:[33]}),e[34]||(e[34]=o(" Batal "))]),_:1,__:[34]}),t(m,{color:"info",variant:"flat",size:"large",onClick:Z,loading:A.value,disabled:!$.value,class:"text-none",elevation:"2"},{default:l(()=>[t(r,{start:""},{default:l(()=>[o(u(v.value===-1?"mdi-content-save-plus":"mdi-content-save-edit"),1)]),_:1}),o(" "+u(v.value===-1?"Tambah Server":"Update Server"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:U.value,"onUpdate:modelValue":e[13]||(e[13]=a=>U.value=a),"max-width":"500px"},{default:l(()=>[t(y,{class:"rounded-xl elevation-8"},{default:l(()=>[t(G,{class:"pa-8 text-center"},{default:l(()=>[t(B,{color:"error",size:"80",class:"mb-4"},{default:l(()=>[t(r,{color:"white",size:"40"},{default:l(()=>e[35]||(e[35]=[o("mdi-delete-alert")])),_:1,__:[35]})]),_:1}),e[40]||(e[40]=n("h2",{class:"text-h5 font-weight-bold text-error mb-3"},"Konfirmasi Hapus",-1)),n("p",Be,[e[36]||(e[36]=o(" Anda yakin ingin menghapus server ")),n("strong",Ne,u(V.value?.name),1),e[37]||(e[37]=o("? "))]),t(re,{type:"warning",variant:"tonal",class:"text-start"},{prepend:l(()=>[t(r,null,{default:l(()=>e[38]||(e[38]=[o("mdi-alert-circle")])),_:1,__:[38]})]),default:l(()=>[e[39]||(e[39]=o(" Tindakan ini tidak dapat dibatalkan. Semua konfigurasi yang terkait dengan server ini akan hilang. "))]),_:1,__:[39]})]),_:1,__:[40]}),t(O,{class:"pa-6 pt-0"},{default:l(()=>[t(I),t(m,{variant:"outlined",size:"large",onClick:q,class:"text-none me-3"},{default:l(()=>e[41]||(e[41]=[o(" Batal ")])),_:1,__:[41]}),t(m,{color:"error",variant:"flat",size:"large",onClick:le,loading:M.value,class:"text-none"},{default:l(()=>[t(r,{start:""},{default:l(()=>e[42]||(e[42]=[o("mdi-delete")])),_:1,__:[42]}),e[43]||(e[43]=o(" Ya, Hapus "))]),_:1,__:[43]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(de,{modelValue:k.value.show,"onUpdate:modelValue":e[14]||(e[14]=a=>k.value.show=a),color:k.value.color,timeout:"4000",location:"top right"},{default:l(()=>[t(r,{start:""},{default:l(()=>[o(u(k.value.icon),1)]),_:1}),o(" "+u(k.value.text),1)]),_:1},8,["modelValue","color"])]),_:1})}}}),Re=ge(Ke,[["__scopeId","data-v-5870b585"]]);export{Re as default};
