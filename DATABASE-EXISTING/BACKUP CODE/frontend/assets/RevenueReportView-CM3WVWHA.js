import{d as ce,r,c as W,o as ue,b as J,w as n,a as T,e as s,f as l,g as t,j as v,h as c,m as X,i as R,t as d,F as me,k as pe,l as p,_ as ve}from"./index-DDZ3D2Zd.js";import{u as z,w as _e}from"./xlsx-mxuUxWRI.js";const ge={class:"d-flex flex-column flex-sm-row align-start align-sm-center mb-6 mb-md-8"},fe={class:"d-flex align-center mb-4 mb-sm-0"},be={class:"d-flex ga-3"},ye={key:0,class:"text-center pa-10 pa-md-16"},xe={class:"loading-container"},ke={key:1,class:"report-content"},he={class:"revenue-gradient pa-6 pa-md-8"},we={class:"d-flex flex-column flex-sm-row align-start align-sm-center"},Ve={class:"revenue-icon-container mb-4 mb-sm-0 me-sm-6"},De={class:"revenue-content"},Pe={class:"text-subtitle-2 text-white-75 mb-3"},Te={class:"revenue-amount text-white"},ze={class:"d-flex align-center"},Be={key:0},Le={key:0,class:"text-center pa-8"},Ie={key:1,class:"pa-2"},Se={class:"d-flex justify-space-between align-start mb-3"},Ne={class:"text-subtitle-2 font-weight-bold text-deep-purple mb-1"},Ce={class:"text-body-2 text-medium-emphasis"},Me={class:"invoice-details"},Re={class:"detail-row"},Ue={class:"text-body-2"},Fe={class:"detail-row"},Ae={class:"text-body-2"},$e={class:"detail-row"},je={class:"text-body-2"},Ee={class:"detail-row"},Ge={class:"text-body-2"},Oe={key:2,class:"d-flex justify-center align-center pa-4"},Je={key:1},Ye={class:"font-weight-bold text-deep-purple"},He={class:"font-weight-medium"},qe={class:"text-body-2 text-truncate",style:{"max-width":"200px"}},Ke={class:"font-weight-bold text-success"},Qe={class:"text-body-2"},We={key:2,class:"empty-state text-center pa-10 pa-md-16"},Xe={class:"empty-state-content"},Ze=ce({__name:"RevenueReportView",setup(ea){const _=r(new Date(new Date().getFullYear(),new Date().getMonth(),1)),g=r(new Date),U=r(!1),F=r(!1),B=r(!1),A=r(!1),m=r(null),w=r([]),$=r(1),j=r(10),k=r(null),Y=r([]),h=r(null),H=r([]),L=r(!1),Z=W(()=>w.value||[]),q=W(()=>m.value?.total_invoices?Math.ceil(m.value.total_invoices/j.value):0);async function ee(){try{const o=await T.get("/pelanggan/lokasi/unik");Y.value=o.data}catch(o){console.error("Gagal mengambil daftar lokasi:",o)}}async function ae(){try{const o=await T.get("/harga_layanan");H.value=o.data}catch(o){console.error("Gagal mengambil daftar brand:",o)}}function te(o){K({page:o,itemsPerPage:j.value,sortBy:[]})}const ne=[{title:"No. Invoice",key:"invoice_number",width:"200px",sortable:!0},{title:"Nama Pelanggan",key:"pelanggan_nama",sortable:!0},{title:"Alamat",key:"alamat",sortable:!1},{title:"Brand",key:"id_brand",sortable:!0},{title:"Tanggal Bayar",key:"paid_at",sortable:!0},{title:"Metode Bayar",key:"metode_pembayaran",sortable:!0},{title:"Jumlah",key:"total_harga",align:"end",sortable:!0}];function I(o){return o.toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"})}function le(o){if(!o)return"grey";const e=o.toLowerCase();return e.includes("cash")?"success":e.includes("transfer")?"info":e.includes("kredit")?"warning":"primary"}async function oe(){if(!m.value||m.value.total_invoices===0){alert("Tidak ada data untuk diekspor!");return}L.value=!0;try{const o={start_date:f(_.value),end_date:f(g.value),alamat:k.value||void 0,id_brand:h.value||void 0},i=(await T.get("/reports/revenue/details",{params:o})).data;if(!i||i.length===0){alert("Tidak ada data yang cocok dengan filter untuk diekspor.");return}const V=i.map(u=>({"Nomor Invoice":u.invoice_number,"Nama Pelanggan":u.pelanggan_nama,Alamat:u.alamat||"","Nama Brand":u.id_brand||"","Tanggal Bayar":new Date(u.paid_at),"Metode Pembayaran":u.metode_pembayaran||"","Jumlah (Rp)":u.total_harga})),b=z.json_to_sheet(V),D=z.book_new();if(z.book_append_sheet(D,b,"Laporan Pendapatan"),b["!cols"]=[{wch:25},{wch:30},{wch:40},{wch:15},{wch:20},{wch:15},{wch:15}],b["!ref"]){const u=z.decode_range(b["!ref"]),C=6;for(let P=u.s.r+1;P<=u.e.r;P++){const M=z.encode_cell({r:P,c:C}),x=b[M];x&&x.t==="n"&&(x.z='"Rp" #,##0')}}const S=f(_.value),y=f(g.value),N=`Laporan_Pendapatan_${S}_sampai_${y}.xlsx`;_e(D,N)}catch(o){console.error("Gagal mengekspor data:",o),alert("Terjadi kesalahan saat mencoba mengekspor data.")}finally{L.value=!1}}function f(o){const e=o.getFullYear(),i=(o.getMonth()+1).toString().padStart(2,"0"),V=o.getDate().toString().padStart(2,"0");return`${e}-${i}-${V}`}async function E(){B.value=!0,m.value=null,w.value=[];try{const o={start_date:f(_.value),end_date:f(g.value),...k.value&&{alamat:k.value},...h.value&&{id_brand:h.value}},e=await T.get("/reports/revenue",{params:o});m.value=e.data}catch(o){console.error("Gagal mengambil data laporan:",o)}finally{B.value=!1}}async function K(o){if(!(!m.value?.total_invoices&&m.value?.total_invoices!==0)){A.value=!0;try{const e={start_date:f(_.value),end_date:f(g.value),alamat:k.value||void 0,id_brand:h.value||void 0,skip:(o.page-1)*o.itemsPerPage,limit:o.itemsPerPage},i=await T.get("/reports/revenue/details",{params:e});$.value=o.page,j.value=o.itemsPerPage,w.value=i.data}catch(e){console.error("Gagal mengambil rincian invoice:",e)}finally{A.value=!1}}}const G=o=>typeof o!="number"?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(o);return ue(()=>{ee(),ae(),E()}),(o,e)=>{const i=s("v-icon"),V=s("v-avatar"),b=s("v-text-field"),D=s("v-date-picker"),S=s("v-menu"),y=s("v-col"),N=s("v-select"),u=s("v-btn"),C=s("v-progress-circular"),P=s("v-row"),M=s("v-card-text"),x=s("v-card"),se=s("v-card-title"),Q=s("v-divider"),O=s("v-chip"),ie=s("v-pagination"),de=s("v-data-table-server"),re=s("v-container");return p(),J(re,{fluid:"",class:"pa-4 pa-md-6"},{default:n(()=>[l("div",ge,[l("div",fe,[t(V,{class:"me-3 modern-avatar",color:"deep-purple",size:"48"},{default:n(()=>[t(i,{color:"white",size:"28"},{default:n(()=>e[9]||(e[9]=[c("mdi-chart-line")])),_:1,__:[9]})]),_:1}),e[10]||(e[10]=l("div",null,[l("h1",{class:"text-h4 text-sm-h3 font-weight-bold text-deep-purple mb-1"},"Laporan Pendapatan"),l("p",{class:"text-subtitle-1 text-body-2 text-medium-emphasis mb-0"},"Analisis pendapatan berdasarkan rentang tanggal")],-1))])]),t(x,{class:"mb-6 mb-md-8 modern-card",elevation:"0",rounded:"xl"},{default:n(()=>[t(M,{class:"pa-4 pa-md-6"},{default:n(()=>[t(P,{align:"center",class:"ga-3"},{default:n(()=>[t(y,{cols:"12",sm:"6",md:"auto",class:"flex-grow-1"},{default:n(()=>[t(S,{modelValue:U.value,"onUpdate:modelValue":e[2]||(e[2]=a=>U.value=a),"close-on-content-click":!1,location:"bottom start",offset:"8"},{activator:n(({props:a})=>[t(b,X({"model-value":I(_.value),label:"Tanggal Awal","prepend-inner-icon":"mdi-calendar",readonly:""},a,{variant:"outlined",density:"comfortable","hide-details":"",class:"modern-input",color:"deep-purple"}),null,16,["model-value"])]),default:n(()=>[t(D,{modelValue:_.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>_.value=a),e[1]||(e[1]=a=>U.value=!1)],color:"deep-purple"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(y,{cols:"12",sm:"6",md:"auto",class:"flex-grow-1"},{default:n(()=>[t(S,{modelValue:F.value,"onUpdate:modelValue":e[5]||(e[5]=a=>F.value=a),"close-on-content-click":!1,location:"bottom start",offset:"8"},{activator:n(({props:a})=>[t(b,X({"model-value":I(g.value),label:"Tanggal Akhir","prepend-inner-icon":"mdi-calendar",readonly:""},a,{variant:"outlined",density:"comfortable","hide-details":"",class:"modern-input",color:"deep-purple"}),null,16,["model-value"])]),default:n(()=>[t(D,{modelValue:g.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>g.value=a),e[4]||(e[4]=a=>F.value=!1)],color:"deep-purple"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(y,{cols:"12",sm:"6",md:"auto",class:"flex-grow-1"},{default:n(()=>[t(N,{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=a=>k.value=a),items:Y.value,label:"Filter Berdasarkan Lokasi","prepend-inner-icon":"mdi-map-marker",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",class:"modern-input",color:"deep-purple"},null,8,["modelValue","items"])]),_:1}),t(y,{cols:"12",sm:"6",md:"auto",class:"flex-grow-1"},{default:n(()=>[t(N,{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=a=>h.value=a),items:H.value,"item-title":"brand","item-value":"id_brand",label:"Filter Berdasarkan Brand","prepend-inner-icon":"mdi-tag",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",class:"modern-input",color:"deep-purple"},null,8,["modelValue","items"])]),_:1}),t(y,{cols:"12",sm:"12",md:"auto"}),t(y,{cols:"12",sm:"6",md:"auto"},{default:n(()=>[l("div",be,[t(u,{color:"deep-purple",onClick:E,loading:B.value,size:"large",class:"text-none modern-btn","prepend-icon":"mdi-magnify",rounded:"lg"},{default:n(()=>e[11]||(e[11]=[c(" Tampilkan ")])),_:1,__:[11]},8,["loading"]),t(u,{color:"green-darken-1",onClick:oe,disabled:!m.value||m.value.total_invoices===0||L.value,size:"large",class:"text-none modern-btn","prepend-icon":"mdi-microsoft-excel",rounded:"lg",variant:"outlined"},{default:n(()=>[e[12]||(e[12]=c(" Ekspor ")),L.value?(p(),J(C,{key:0,indeterminate:"",size:"20",class:"ms-2"})):R("",!0)]),_:1,__:[12]},8,["disabled"])])]),_:1})]),_:1})]),_:1})]),_:1}),B.value?(p(),v("div",ye,[l("div",xe,[t(C,{indeterminate:"",color:"deep-purple",size:"80",width:"4",class:"mb-4"}),e[13]||(e[13]=l("h3",{class:"text-h6 text-medium-emphasis mb-2"},"Memuat data laporan...",-1)),e[14]||(e[14]=l("p",{class:"text-body-2 text-medium-emphasis"},"Harap tunggu sebentar",-1))])])):m.value?(p(),v("div",ke,[t(x,{class:"mb-6 mb-md-8 revenue-card",elevation:"0",rounded:"xl"},{default:n(()=>[l("div",he,[l("div",we,[l("div",Ve,[t(i,{color:"white",size:"48",class:"revenue-icon"},{default:n(()=>e[15]||(e[15]=[c("mdi-cash-multiple")])),_:1,__:[15]})]),l("div",De,[e[16]||(e[16]=l("div",{class:"text-caption text-white-50 mb-2 font-weight-medium text-uppercase tracking-wide"}," Total Pendapatan ",-1)),l("div",Pe,d(I(_.value))+" - "+d(I(g.value)),1),l("div",Te,d(G(m.value.total_pendapatan)),1)])])])]),_:1}),t(x,{elevation:"0",rounded:"xl",class:"modern-card"},{default:n(()=>[t(se,{class:"pa-4 pa-md-6 table-header"},{default:n(()=>[l("div",ze,[t(i,{start:"",color:"deep-purple",size:"24"},{default:n(()=>e[17]||(e[17]=[c("mdi-receipt-text-check")])),_:1,__:[17]}),e[18]||(e[18]=l("span",{class:"text-h6 font-weight-bold"},"Rincian Invoice Lunas",-1))])]),_:1}),t(Q,{class:"mx-4 mx-md-6"}),o.$vuetify.display.mdAndUp?R("",!0):(p(),v("div",Be,[w.value.length===0?(p(),v("div",Le,[t(i,{size:"48",color:"grey-lighten-1",class:"mb-4"},{default:n(()=>e[19]||(e[19]=[c("mdi-receipt-text-off")])),_:1,__:[19]}),e[20]||(e[20]=l("p",{class:"text-body-1 text-medium-emphasis"},"Tidak ada data invoice untuk periode ini",-1))])):(p(),v("div",Ie,[(p(!0),v(me,null,pe(Z.value,a=>(p(),J(x,{key:a.invoice_number,class:"mb-3 mobile-invoice-card",elevation:"1",rounded:"lg"},{default:n(()=>[t(M,{class:"pa-4"},{default:n(()=>[l("div",Se,[l("div",null,[l("div",Ne,d(a.invoice_number),1),l("div",Ce,d(a.pelanggan_nama),1)]),t(O,{color:"success",variant:"tonal",size:"small",class:"font-weight-bold"},{default:n(()=>[c(d(G(a.total_harga)),1)]),_:2},1024)]),t(Q,{class:"mb-3"}),l("div",Me,[l("div",Re,[t(i,{size:"16",color:"grey-darken-1",class:"me-2"},{default:n(()=>e[21]||(e[21]=[c("mdi-map-marker")])),_:1,__:[21]}),l("span",Ue,d(a.alamat||"Tidak ada alamat"),1)]),l("div",Fe,[t(i,{size:"16",color:"grey-darken-1",class:"me-2"},{default:n(()=>e[22]||(e[22]=[c("mdi-tag")])),_:1,__:[22]}),l("span",Ae,d(a.id_brand||"Tidak ada brand"),1)]),l("div",$e,[t(i,{size:"16",color:"grey-darken-1",class:"me-2"},{default:n(()=>e[23]||(e[23]=[c("mdi-calendar")])),_:1,__:[23]}),l("span",je,d(new Date(a.paid_at).toLocaleString("id-ID")),1)]),l("div",Ee,[t(i,{size:"16",color:"grey-darken-1",class:"me-2"},{default:n(()=>e[24]||(e[24]=[c("mdi-credit-card")])),_:1,__:[24]}),l("span",Ge,d(a.metode_pembayaran||"Tidak tercatat"),1)])])]),_:2},1024)]),_:2},1024))),128))])),q.value>1?(p(),v("div",Oe,[t(ie,{modelValue:$.value,"onUpdate:modelValue":[e[8]||(e[8]=a=>$.value=a),te],length:q.value,"total-visible":5},null,8,["modelValue","length"])])):R("",!0)])),o.$vuetify.display.mdAndUp?(p(),v("div",Je,[t(de,{headers:ne,items:w.value,"items-length":m.value?.total_invoices||0,loading:A.value,"onUpdate:options":K,class:"modern-table","no-data-text":"Tidak ada data invoice untuk periode ini"},{"item.invoice_number":n(({item:a})=>[l("div",Ye,d(a.invoice_number),1)]),"item.pelanggan_nama":n(({item:a})=>[l("div",He,d(a.pelanggan_nama),1)]),"item.alamat":n(({item:a})=>[l("div",qe,d(a.alamat||"Tidak ada alamat"),1)]),"item.id_brand":n(({item:a})=>[t(O,{variant:"tonal",color:"primary",size:"small",class:"font-weight-medium"},{default:n(()=>[c(d(a.id_brand||"No Brand"),1)]),_:2},1024)]),"item.total_harga":n(({item:a})=>[l("div",Ke,d(G(a.total_harga)),1)]),"item.paid_at":n(({item:a})=>[l("div",Qe,d(new Date(a.paid_at).toLocaleString("id-ID")),1)]),"item.metode_pembayaran":n(({item:a})=>[t(O,{variant:"outlined",size:"small",color:le(a.metode_pembayaran)},{default:n(()=>[c(d(a.metode_pembayaran||"Tidak tercatat"),1)]),_:2},1032,["color"])]),_:1},8,["items","items-length","loading"])])):R("",!0)]),_:1})])):(p(),v("div",We,[l("div",Xe,[t(i,{size:"80",color:"grey-lighten-2",class:"mb-6"},{default:n(()=>e[25]||(e[25]=[c("mdi-chart-line-variant")])),_:1,__:[25]}),e[27]||(e[27]=l("h3",{class:"text-h6 mb-4 text-medium-emphasis"},"Belum ada data laporan",-1)),e[28]||(e[28]=l("p",{class:"text-body-1 text-medium-emphasis mb-6"},' Silakan pilih rentang tanggal dan klik "Tampilkan Laporan" untuk melihat data pendapatan. ',-1)),t(u,{color:"deep-purple",variant:"tonal",size:"large",rounded:"lg",onClick:E,class:"text-none"},{default:n(()=>e[26]||(e[26]=[c(" Mulai Analisis ")])),_:1,__:[26]})])]))]),_:1})}}}),na=ve(Ze,[["__scopeId","data-v-14217b81"]]);export{na as default};
